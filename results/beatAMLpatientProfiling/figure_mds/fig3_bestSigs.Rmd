---
title: "Figure 3 Performance in Cell Lines"
author: "Sara Gosline"
date: "11/13/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)


library(amlresistancenetworks)

if(!exists('dataLoaded')){
  amlresistancenetworks::loadBeatAMLData()
  dataLoaded=TRUE
}

```

## Best signatures from LASSO

From the predictions we can select those results that have the _best_ response, and plot those below. 

```{r lasso preds,warning=FALSE,echo=FALSE}


#'
#'selectDataMatAndPlot matches the output of a predictor (new.results) to the AUC data
#'and original molecular data to create heatmap
#'and combines ith with the specified data type and passes along a method to be used
#'@param drugName
#'@param meth
#'@param data
#'@return output of prediction
selectDataMatAndPlot<-function(drugName,meth,data,doEnrich=FALSE){
  #get dimensionality-reduced samples
  if(data%in%c('proteinLevels','mRNALevels','geneMutations') &&!is.null(pat.data))
    data.mat<-pat.data%>%dplyr::rename(value=data,Sample='AML sample')
  else if(data=='Latent Variable'&&!is.null(lv.df))
    data.mat<-lv.df%>%dplyr::rename(Gene='Latent_Variable',Sample='AML_sample',value='Loading')
  else if(data=='KinaseExpr'&&!is.null(pat.kin))
    data.mat<-pat.kin%>%dplyr::select(Gene='Kinase',Sample,value='meanLFC')
  else if(data=='Phosphosite'&&!is.null(pat.phos)){
    data.mat<-pat.phos%>%dplyr::select(Gene='site',Sample,value='LogFoldChange')
  }else if(data=='proteomicNetworkDistance'&&!is.null(prot.nets))
    data.mat<-prot.nets%>%dplyr::select(Gene='Community',value='distance',Sample=`AML sample`)
#  else if(data=='mutationNetworkDistances' && !is.null(mut.nets))
#    data.mat<-mut.nets%>%dplyr::select(Gene='Community',value='distance',Sample=`AML sample`)
  else{
    print(paste("Do not have data for",data))
    return(NULL)
  }
  
  auc.d<-auc.dat%>%
    dplyr::select(-c(medAUC,percAUC,overallSurvival,ageAtDiagnosis))%>%
    dplyr::rename(Sample='AML sample')

    clusterSingleDrugEfficacy(drugName,meth,data,doEnrich=doEnrich,auc.dat=auc.d,auc.thresh=100,
                            new.results,data.mat)  
}


  new.results<-reg.preds%>%subset(numFeatures>0)%>%subset(MSE<1500)%>%  
    mutate(method='LASSO',doEnrich=TRUE)%>%
  rowwise()%>%mutate(enrich=list(selectDataMatAndPlot(var,method,Molecular,doEnrich)))
```

## best signatures for logistic resgression

You can also embed plots, for example:

```{r logr preds, echo=FALSE, warning=FALSE}
 other.results<-logr.preds%>%subset(numFeatures>0)%>%subset(MSE<0.21)
  mutate(doEnrich=TRUE)%>%
  rowwise()%>%mutate(enrich=list(selectDataMatAndPlot(var,method,Molecular,doEnrich)))

```


